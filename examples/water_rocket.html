

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Water Rocket &#8212; dymos 0.15.1-dev documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multibranch Trajectory" href="multibranch_trajectory.html" />
    <link rel="prev" title="Multi-Phase Cannonball" href="multi_phase_cannonball.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="multibranch_trajectory.html" title="Multibranch Trajectory"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="multi_phase_cannonball.html" title="Multi-Phase Cannonball"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">dymos 0.15.1-dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" accesskey="U">Dymos by Example</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Water Rocket</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="water-rocket">
<span id="id1"></span><h1>Water Rocket<a class="headerlink" href="#water-rocket" title="Permalink to this headline">¶</a></h1>
<p>Author: Bernardo Bahia Monteiro &lt;<a class="reference external" href="mailto:bbahia&#37;&#52;&#48;umich&#46;edu">bbahia<span>&#64;</span>umich<span>&#46;</span>edu</a>&gt;</p>
<p>In this example, we will optimize a water rocket for range and height at the
apogee, using design variables that are easily modifiable just before launch:
the empty mass, the initial water volume and the launch angle.
This example builds on <a class="reference internal" href="multi_phase_cannonball.html#multi-phase-cannonball"><span class="std std-ref">Multi-Phase Cannonball</span></a> and
is adapted from <a class="bibtex reference internal" href="#bbahia-2020" id="id2">[1]</a>.</p>
<div class="section" id="nomenclature">
<h2>Nomenclature<a class="headerlink" href="#nomenclature" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 66%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(v_\text{out}\)</span></p></td>
<td><p>water exit speed at the nozzle</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(A_\text{out}\)</span></p></td>
<td><p>nozzle area</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(V_w\)</span></p></td>
<td><p>water volume in the rocket</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p\)</span></p></td>
<td><p>pressure in the rocket</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_a\)</span></p></td>
<td><p>ambient pressure</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\dot{\,}\)</span></p></td>
<td><p>time derivative</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(k\)</span></p></td>
<td><p>polytropic constant</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(V_b\)</span></p></td>
<td><p>internal volume of the rocket</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\rho_w\)</span></p></td>
<td><p>water density</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T\)</span></p></td>
<td><p>thrust</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(q\)</span></p></td>
<td><p>dynamic pressure</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(S\)</span></p></td>
<td><p>cross sectional area</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\((\cdot)_0\)</span></p></td>
<td><p>value of <span class="math notranslate nohighlight">\((\cdot)\)</span> at <span class="math notranslate nohighlight">\(t=0\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(t\)</span></p></td>
<td><p>time</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="problem-formulation">
<h2>Problem Formulation<a class="headerlink" href="#problem-formulation" title="Permalink to this headline">¶</a></h2>
<p>A natural objective function for a water rocket is the maximum height achieved
by the rocket during flight, or the horizontal distance it travels, i.e. its
range. The design of a water rocket is somewhat constrained by the soda bottle
used as its engine. This means that the volume available for water and air
is fixed, the initial launch pressure is limited by the bottle’s strength
(since the pressure is directly related to the energy available for the rocket,
it is easy to see that it should be as high as possible) and the nozzle throat
area is also fixed. Given these manufacturing constraints, the design variables
we are left with are the empty mass (it can be easily changed through adding
ballast), the water volume at the launch, and the launch angle.
With this considerations in mind, a natural formulation for the water rocket problem is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{maximize}   &amp;\quad \text{range or height} \\
\text{w.r.t.}     &amp;\quad \text{empty mass, initial water volume, launch angle, trajectory} \\
\text{subject to} &amp;\quad \text{flight dynamics} \\
                  &amp;\quad \text{fluid dynamics inside the rocket} \\
                  &amp;\quad 0 &lt; \text{initial water volume} &lt; \text{volume of bottle} \\
                  &amp;\quad 0^\circ &lt; \text{launch angle} &lt; 90^\circ \\
                  &amp;\quad 0 &lt; \text{empty mass}\end{split}\]</div>
</div>
<div class="section" id="model">
<h2>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h2>
<p>The water rocket model is divided into three basic components: a <em>water engine</em>,
responsible for modelling the fluid dynamics inside the rocket and returning
its thrust;  the <em>aerodynamics</em>, responsible for calculating the atmospheric drag
of the rocket; and the <em>equations of motion</em>, responsible for propagating the
rocket’s trajectory in time, using Newton’s laws and the forces provided by the
other two components.</p>
<p>In order to integrate these three basic components, some additional interfacing
components are necessary: an atmospheric model to provide values of ambient
pressure for the water engine and air density to the calculation of the dynamic
pressure for the aerodynamic model, and a component that calculates the
instantaneous mass of the rocket by summing the water mass with the rocket’s
empty mass.  The high level layout of this model is shown in below.</p>
<div class="figure align-default" id="id14">
<img alt="overview" src="../_images/water_rocket_overview.svg" /><p class="caption"><span class="caption-text">N2 diagram for the water rocket model</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</div>
<p><cite>atmos</cite>, <cite>kinetic_energy</cite>, <cite>dynamic_pressure</cite>, <cite>aero</cite> and <cite>eom</cite> are the same
models used in <a class="reference internal" href="multi_phase_cannonball.html#multi-phase-cannonball"><span class="std std-ref">Multi-Phase Cannonball</span></a>.  The remaining components are
discussed below.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <cite>eom</cite> component has a singularity in the flight path angle derivative
when the flight speed is zero.  This happens because the rotational
dynamics are not modelled.  This can cause convergence problems if the
launch velocity is set to zero or the launch angle is set to
<span class="math notranslate nohighlight">\(90^\circ\)</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the range of altitudes achieved by the water rocket is very small
(100m), the air density and pressure are practically constant, thus the use
of an atmospheric model is not necessary.  However, using it makes it
easier to reuse code from <a class="reference internal" href="multi_phase_cannonball.html#multi-phase-cannonball"><span class="std std-ref">Multi-Phase Cannonball</span></a>.</p>
</div>
</div>
<div class="section" id="water-engine">
<h2>Water engine<a class="headerlink" href="#water-engine" title="Permalink to this headline">¶</a></h2>
<p>The water engine is modelled by assuming that the air expansion in the rocket
follows an adiabatic process and the water flow is incompressible and inviscid,
i.e.  it follows Bernoulli’s equation. We also make the following simplifying
assumptions:</p>
<ol class="arabic simple">
<li><p>The thrust developed after the water is depleted is negligible</p></li>
<li><p>The area inside the bottle is much smaller than the nozzle area</p></li>
<li><p>The inertial forces do not affect the fluid dynamics inside the bottle</p></li>
</ol>
<p>This simplified modelling can be found in <a class="bibtex reference internal" href="#prusa2000" id="id3">[2]</a>.  A more rigorous
formulation, which drops all these simplifying assumptions can be found in
<a class="bibtex reference internal" href="#wheeler2002" id="id4">[3]</a><a class="bibtex reference internal" href="#gommes2010" id="id5">[4]</a><a class="bibtex reference internal" href="#barrioperotti2010" id="id6">[5]</a>.</p>
<p>The first assumption leads to an underestimation of the rocket performance,
since the air left in the bottle after it is out of water is known to generate
appreciable thrust <a class="bibtex reference internal" href="#thorncroft2009" id="id7">[6]</a>.  This simplified model, however,
produces physically meaningful results.</p>
<p>There are two states in this dynamical model, the water volume in the rocket
<span class="math notranslate nohighlight">\(V_w\)</span> and the gauge pressure inside the rocket <span class="math notranslate nohighlight">\(p\)</span>.  The
constitutive equations and the N2 diagram showing the model organization are
shown below.</p>
<table class="docutils align-default" id="id15">
<caption><span class="caption-text">Constitutive equations of the water engine model</span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Equation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>water_exhaust_speed</p></td>
<td><p><span class="math notranslate nohighlight">\(v_\text{out} = \sqrt{2(p-p_a)/\rho_w}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>water_flow_rate</p></td>
<td><p><span class="math notranslate nohighlight">\(\dot{V}_w = -v_\text{out} A_\text{out}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>pressure_rate</p></td>
<td><p><span class="math notranslate nohighlight">\(\dot{p} = kp\frac{\dot{V_w}}{(V_b-V_w)}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>water_thrust</p></td>
<td><p><span class="math notranslate nohighlight">\(T = (\rho_w v_\text{out})(v_\text{out}A_\text{out})\)</span></p></td>
</tr>
</tbody>
</table>
<div class="figure align-default" id="id16">
<img alt="water_engine" src="../_images/water_rocket_waterengine.svg" /><p class="caption"><span class="caption-text">N2 diagram for the water engine group</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</div>
<p>The <cite>_MassAdder</cite> component calculates the rocket’s instantaneous mass by
summing the water mass with the rockets empty mass, i.e.</p>
<div class="math notranslate nohighlight">
\[m = m_\text{empty}+\rho_w V_w\]</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>


<span class="k">class</span> <span class="nc">WaterEngine</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes thrust and water flow for a water.</span>

<span class="sd">    Simplifications:</span>
<span class="sd">     - the pressure due to the water column in the non inertial frame (i.e.</span>
<span class="sd">       under a+g acceleration) is insignificant compared to the air pressure</span>
<span class="sd">     - the water does not have appreciable speed inside the bottle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;water_exhaust_speed&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">_WaterExhaustSpeed</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">),</span>
                           <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;p_a&#39;</span><span class="p">,</span> <span class="s1">&#39;rho_w&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;water_flow_rate&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">_WaterFlowRate</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">),</span>
                           <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A_out&#39;</span><span class="p">,</span> <span class="s1">&#39;Vdot&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pressure_rate&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">_PressureRate</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">),</span>
                           <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;V_b&#39;</span><span class="p">,</span> <span class="s1">&#39;V_w&#39;</span><span class="p">,</span> <span class="s1">&#39;Vdot&#39;</span><span class="p">,</span> <span class="s1">&#39;pdot&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;water_thrust&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">_WaterThrust</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">),</span>
                           <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">,</span> <span class="s1">&#39;A_out&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;water_exhaust_speed.v_out&#39;</span><span class="p">,</span> <span class="s1">&#39;water_flow_rate.v_out&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;water_exhaust_speed.v_out&#39;</span><span class="p">,</span> <span class="s1">&#39;water_thrust.v_out&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_WaterExhaustSpeed</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;rho_w&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water density&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">6.5e5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;air pressure&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">)</span>  <span class="c1"># 5.5bar = 80 psi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p_a&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.01e5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;air pressure&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v_out&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nn</span><span class="p">,),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water exhaust speed&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>

        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="n">of</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">ar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">p_a</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;p_a&#39;</span><span class="p">]</span>
        <span class="n">rho_w</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">]</span>

        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">p_a</span><span class="p">)</span><span class="o">/</span><span class="n">rho_w</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_partials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">partials</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">p_a</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;p_a&#39;</span><span class="p">]</span>
        <span class="n">rho_w</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">]</span>

        <span class="n">v_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">p_a</span><span class="p">)</span><span class="o">/</span><span class="n">rho_w</span><span class="p">)</span>

        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">v_out</span><span class="o">/</span><span class="n">rho_w</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">,</span> <span class="s1">&#39;p_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">v_out</span><span class="o">/</span><span class="n">rho_w</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">,</span> <span class="s1">&#39;rho_w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dv_outdrho_w</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">v_out</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">p_a</span><span class="p">)</span><span class="o">/</span><span class="n">rho_w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_WaterFlowRate</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Computer water flow rate&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;A_out&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;nozzle outlet area&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v_out&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water exhaust speed&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Vdot&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nn</span><span class="p">,),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water flow&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3/s&#39;</span><span class="p">)</span>

        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="n">of</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">ar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="n">A_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;A_out&#39;</span><span class="p">]</span>
        <span class="n">v_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">]</span>

        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Vdot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">v_out</span><span class="o">*</span><span class="n">A_out</span>

    <span class="k">def</span> <span class="nf">compute_partials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">partials</span><span class="p">):</span>
        <span class="n">A_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;A_out&#39;</span><span class="p">]</span>
        <span class="n">v_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">]</span>

        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;Vdot&#39;</span><span class="p">,</span> <span class="s1">&#39;A_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">v_out</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;Vdot&#39;</span><span class="p">,</span> <span class="s1">&#39;v_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">A_out</span>


<span class="k">class</span> <span class="nc">_PressureRate</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;air pressure&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;polytropic coefficient for expansion&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;V_b&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">2e-3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;bottle volume&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;V_w&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water volume&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Vdot&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nn</span><span class="p">,),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water flow&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3/s&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pdot&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nn</span><span class="p">,),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;pressure derivative&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2/s&#39;</span><span class="p">)</span>

        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="n">of</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">ar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
        <span class="n">V_b</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;V_b&#39;</span><span class="p">]</span>
        <span class="n">V_w</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;V_w&#39;</span><span class="p">]</span>
        <span class="n">Vdot</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Vdot&#39;</span><span class="p">]</span>

        <span class="n">pdot</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">Vdot</span><span class="o">/</span><span class="p">(</span><span class="n">V_b</span><span class="o">-</span><span class="n">V_w</span><span class="p">)</span>

        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;pdot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdot</span>

    <span class="k">def</span> <span class="nf">compute_partials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">partials</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
        <span class="n">V_b</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;V_b&#39;</span><span class="p">]</span>
        <span class="n">V_w</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;V_w&#39;</span><span class="p">]</span>
        <span class="n">Vdot</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Vdot&#39;</span><span class="p">]</span>

        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;pdot&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">Vdot</span><span class="o">/</span><span class="p">(</span><span class="n">V_b</span><span class="o">-</span><span class="n">V_w</span><span class="p">)</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;pdot&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">Vdot</span><span class="o">/</span><span class="p">(</span><span class="n">V_b</span><span class="o">-</span><span class="n">V_w</span><span class="p">)</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;pdot&#39;</span><span class="p">,</span> <span class="s1">&#39;V_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">Vdot</span><span class="o">/</span><span class="p">(</span><span class="n">V_b</span><span class="o">-</span><span class="n">V_w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;pdot&#39;</span><span class="p">,</span> <span class="s1">&#39;V_w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">Vdot</span><span class="o">/</span><span class="p">(</span><span class="n">V_b</span><span class="o">-</span><span class="n">V_w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;pdot&#39;</span><span class="p">,</span> <span class="s1">&#39;Vdot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="p">(</span><span class="n">V_b</span><span class="o">-</span><span class="n">V_w</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_WaterThrust</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;rho_w&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water density&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;A_out&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">13e-3</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;nozzle outlet area&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v_out&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water exhaust speed&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nn</span><span class="p">,),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;thrust&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>

        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="n">of</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">ar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="n">rho_w</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">]</span>
        <span class="n">A_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;A_out&#39;</span><span class="p">]</span>
        <span class="n">v_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">]</span>

        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_w</span><span class="o">*</span><span class="n">v_out</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">A_out</span>

    <span class="k">def</span> <span class="nf">compute_partials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">partials</span><span class="p">):</span>
        <span class="n">rho_w</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">]</span>
        <span class="n">A_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;A_out&#39;</span><span class="p">]</span>
        <span class="n">v_out</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;v_out&#39;</span><span class="p">]</span>

        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;A_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_w</span><span class="o">*</span><span class="n">v_out</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;rho_w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_out</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">A_out</span>
        <span class="n">partials</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;v_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">rho_w</span><span class="o">*</span><span class="n">v_out</span><span class="o">*</span><span class="n">A_out</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">WaterEngine</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">check_config</span><span class="p">(</span><span class="n">checks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;unconnected_inputs&#39;</span><span class="p">],</span> <span class="n">out_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">final_setup</span><span class="p">()</span>
</pre></div>
</div>
<p>Now these components are joined in a single group</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>
<span class="kn">from</span> <span class="nn">dymos.examples.min_time_climb.aero.dynamic_pressure_comp</span> <span class="kn">import</span> <span class="n">DynamicPressureComp</span>
<span class="kn">from</span> <span class="nn">dymos.examples.min_time_climb.aero.lift_drag_force_comp</span> <span class="kn">import</span> <span class="n">LiftDragForceComp</span>
<span class="kn">from</span> <span class="nn">dymos.models.atmosphere</span> <span class="kn">import</span> <span class="n">USatm1976Comp</span>
<span class="kn">from</span> <span class="nn">dymos.models.eom</span> <span class="kn">import</span> <span class="n">FlightPathEOM2D</span>
<span class="kn">from</span> <span class="nn">dymos.examples.cannonball.kinetic_energy_comp</span> <span class="kn">import</span> <span class="n">KineticEnergyComp</span>
<span class="kn">from</span> <span class="nn">.water_engine_comp</span> <span class="kn">import</span> <span class="n">WaterEngine</span>


<span class="k">class</span> <span class="nc">WaterPropulsionODE</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;atmos&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">USatm1976Comp</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kinetic_energy&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">KineticEnergyComp</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;water_engine&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">WaterEngine</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_adder&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">_MassAdder</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dynamic_pressure&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">DynamicPressureComp</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;aero&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">LiftDragForceComp</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
                           <span class="n">subsys</span><span class="o">=</span><span class="n">FlightPathEOM2D</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">nn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;atmos.rho&#39;</span><span class="p">,</span> <span class="s1">&#39;dynamic_pressure.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;atmos.pres&#39;</span><span class="p">,</span> <span class="s1">&#39;water_engine.p_a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dynamic_pressure.q&#39;</span><span class="p">,</span> <span class="s1">&#39;aero.q&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero.f_drag&#39;</span><span class="p">,</span> <span class="s1">&#39;eom.D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;aero.f_lift&#39;</span><span class="p">,</span> <span class="s1">&#39;eom.L&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;water_engine.F&#39;</span><span class="p">,</span> <span class="s1">&#39;eom.T&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;mass_adder.m&#39;</span><span class="p">,</span> <span class="s1">&#39;eom.m&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_MassAdder</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s1">&#39;m_empty&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;empty mass&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s1">&#39;V_w&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;water volume&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s1">&#39;rho_w&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;water density&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total mass&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>

        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">ar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;m_empty&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;V_w&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">compute_partials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">jacobian</span><span class="p">):</span>
        <span class="n">jacobian</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;m_empty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">jacobian</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;rho_w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;V_w&#39;</span><span class="p">]</span>
        <span class="n">jacobian</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;V_w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;rho_w&#39;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">WaterPropulsionODE</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">check_config</span><span class="p">(</span><span class="n">checks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;unconnected_inputs&#39;</span><span class="p">],</span> <span class="n">out_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">final_setup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="phases">
<h2>Phases<a class="headerlink" href="#phases" title="Permalink to this headline">¶</a></h2>
<p>The flight of the water rocket is split in three distinct phases:
propelled ascent, ballistic ascent and ballistic descent.
If the simplification of no thrust without water were lifted,
there would be an extra “air propelled ascent” phase between
the propelled ascent and ballistic ascent phases.</p>
<p><strong>Propelled ascent:</strong> is the flight phase where the rocket still has water
inside, and hence it is producing thrust. The thrust is given by the water
engine model, and fed into the flight dynamic equations. It starts at launch
and finishes when the water is depleted, i.e. <span class="math notranslate nohighlight">\(V_w=0\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_propelled_ascent_phase</span><span class="p">(</span><span class="n">transcription</span><span class="p">):</span>
    <span class="n">propelled_ascent</span> <span class="o">=</span> <span class="n">CannonballPhase</span><span class="p">(</span><span class="n">ode_class</span><span class="o">=</span><span class="n">WaterPropulsionODE</span><span class="p">,</span>
                                       <span class="n">transcription</span><span class="o">=</span><span class="n">transcription</span><span class="p">)</span>

    <span class="c1"># Add states specific for the propelled ascent</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">rate_source</span><span class="o">=</span><span class="s1">&#39;water_engine.pdot&#39;</span><span class="p">,</span>
                               <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;water_engine.p&#39;</span><span class="p">])</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s1">&#39;V_w&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">rate_source</span><span class="o">=</span><span class="s1">&#39;water_engine.Vdot&#39;</span><span class="p">,</span>
                               <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;water_engine.V_w&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_adder.V_w&#39;</span><span class="p">])</span>

    <span class="c1"># All initial states except flight path angle and water volume are fixed</span>
    <span class="c1"># Final flight path angle is fixed (we will set it to zero so that the phase ends at apogee)</span>
    <span class="c1"># Final water volume is fixed (we will set it to zero so that phase ends when bottle empties)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_time_options</span><span class="p">(</span>
        <span class="n">fix_initial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration_bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">duration_ref</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;gam&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">89</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;V_w&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span>
        <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aero.S&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span>
        <span class="s1">&#39;m_empty&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mass_adder.m_empty&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span>
        <span class="s1">&#39;V_b&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;water_engine.V_b&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">)</span>

    <span class="n">propelled_ascent</span><span class="o">.</span><span class="n">add_timeseries_output</span><span class="p">(</span><span class="s1">&#39;water_engine.F&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">propelled_ascent</span>
</pre></div>
</div>
<p><strong>Ballistic ascent:</strong> is the flight phase where the rocket is ascending
(<span class="math notranslate nohighlight">\(\gamma&gt;0\)</span>) but produces no thrust. This phase begins at the end of the
propelled ascent phase and ends at the apogee, defined by <span class="math notranslate nohighlight">\(\gamma=0\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_ballistic_ascent_phase</span><span class="p">(</span><span class="n">transcription</span><span class="p">):</span>
    <span class="n">ballistic_ascent</span> <span class="o">=</span> <span class="n">CannonballPhase</span><span class="p">(</span><span class="n">transcription</span><span class="o">=</span><span class="n">transcription</span><span class="p">)</span>

    <span class="c1"># All initial states are free (they will be  linked to the final stages of propelled_ascent).</span>
    <span class="c1"># Final flight path angle is fixed (we will set it to zero so that the phase ends at apogee)</span>
    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">set_time_options</span><span class="p">(</span>
        <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initial_bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">duration_bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="n">duration_ref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;gam&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">89</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">set_state_options</span><span class="p">(</span>
        <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span>
        <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aero.S&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">)</span>
    <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span>
        <span class="s1">&#39;m_empty&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;eom.m&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ballistic_ascent</span>
</pre></div>
</div>
<p><strong>Descent:</strong> is the phase where the rocket is descending without thrust. It
begins at the end of the ballistic ascent phase and ends with ground impact,
i.e. <span class="math notranslate nohighlight">\(h=0\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_descent_phase</span><span class="p">(</span><span class="n">transcription</span><span class="p">):</span>
    <span class="n">descent</span> <span class="o">=</span> <span class="n">CannonballPhase</span><span class="p">(</span><span class="n">transcription</span><span class="o">=</span><span class="n">transcription</span><span class="p">)</span>

    <span class="c1"># All initial states and time are free (they will be linked to the final states of ballistic_ascent).</span>
    <span class="c1"># Final altitude is fixed (we will set it to zero so that the phase ends at ground impact)</span>
    <span class="n">descent</span><span class="o">.</span><span class="n">set_time_options</span><span class="p">(</span><span class="n">initial_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">duration_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                             <span class="n">duration_ref</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">descent</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">descent</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">descent</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s1">&#39;gam&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">descent</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">fix_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">descent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aero.S&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">)</span>
    <span class="n">descent</span><span class="o">.</span><span class="n">add_input_parameter</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;eom.m&#39;</span><span class="p">,</span> <span class="s1">&#39;kinetic_energy.m&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">descent</span>
</pre></div>
</div>
</div>
<div class="section" id="model-parameters">
<h2>Model parameters<a class="headerlink" href="#model-parameters" title="Permalink to this headline">¶</a></h2>
<p>The model requires a few constant parameters.
The values used are shown in the following table.</p>
<table class="docutils align-default" id="id17">
<caption><span class="caption-text">Values for parameters in the water rocket model</span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 19%" />
<col style="width: 14%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Reference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(C_D\)</span></p></td>
<td><p>0.3450</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p><a class="bibtex reference internal" href="#barrioperotti2009" id="id8">[7]</a></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(S\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pi 106^2/4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mm^2\)</span></p></td>
<td><p><a class="bibtex reference internal" href="#barrioperotti2009" id="id9">[7]</a></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(k\)</span></p></td>
<td><p>1.2</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p><a class="bibtex reference internal" href="#thorncroft2009" id="id10">[6]</a><a class="bibtex reference internal" href="#fischer2020" id="id11">[8]</a><a class="bibtex reference internal" href="#romanelli2013" id="id12">[9]</a></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(A_\text{out}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pi22^2/4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mm^2\)</span></p></td>
<td><p><a class="bibtex reference internal" href="#aircommand-nozzle" id="id13">[10]</a></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(V_b\)</span></p></td>
<td><p>2</p></td>
<td><p>L</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\rho_w\)</span></p></td>
<td><p>1000</p></td>
<td><p><span class="math notranslate nohighlight">\(kg/m^3\)</span></p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_0\)</span></p></td>
<td><p>6.5</p></td>
<td><p>bar</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(v_0\)</span></p></td>
<td><p>0.1</p></td>
<td><p><span class="math notranslate nohighlight">\(m/s\)</span></p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(h_0\)</span></p></td>
<td><p>0</p></td>
<td><p><span class="math notranslate nohighlight">\(m\)</span></p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(r_0\)</span></p></td>
<td><p>0</p></td>
<td><p><span class="math notranslate nohighlight">\(m\)</span></p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Values for the bottle volume <span class="math notranslate nohighlight">\(V_b\)</span>, its cross-sectional area <span class="math notranslate nohighlight">\(S\)</span>
and the nozzle area <span class="math notranslate nohighlight">\(A_\text{out}\)</span> are determined by the soda bottle that
makes the rocket primary structure, and thus are not easily modifiable by the
designer.  The polytropic coefficient <span class="math notranslate nohighlight">\(k\)</span> is a function of the moist air
characteristics inside the rocket.  The initial speed <span class="math notranslate nohighlight">\(v_0\)</span> must be set
to a value higher than zero, otherwise the flight dynamic equations become
singular.  This issue arises from the angular dynamics of the rocket not being
modelled.  The drag coefficient <span class="math notranslate nohighlight">\(C_D\)</span> is sensitive to the aerodynamic
design, but can be optimized by a single discipline analysis.  The initial
pressure <span class="math notranslate nohighlight">\(p_0\)</span> should be maximized in order to obtain the maximum range
or height for the rocket.  It is limited by the structural properties of the
bottle, which are modifiable by the designer, since the bottle needs to be
available commercially.  Finally, the starting point of the rocket is set to
the origin.</p>
</div>
<div class="section" id="puttting-it-all-together">
<h2>Puttting it all together<a class="headerlink" href="#puttting-it-all-together" title="Permalink to this headline">¶</a></h2>
<p>The different phases must be combined in a single trajectory,
and linked in a sequence.
Here we also define the design variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_water_rocket_trajectory</span><span class="p">(</span><span class="n">objective</span><span class="p">):</span>
    <span class="n">transcription</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">GaussLobatto</span><span class="p">(</span><span class="n">num_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traj</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">Trajectory</span><span class="p">()</span>

    <span class="c1"># Add phases to trajectory</span>
    <span class="n">propelled_ascent</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">,</span> <span class="n">new_propelled_ascent_phase</span><span class="p">(</span><span class="n">transcription</span><span class="p">))</span>
    <span class="n">ballistic_ascent</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">,</span> <span class="n">new_ballistic_ascent_phase</span><span class="p">(</span><span class="n">transcription</span><span class="p">))</span>
    <span class="n">descent</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s1">&#39;descent&#39;</span><span class="p">,</span> <span class="n">new_descent_phase</span><span class="p">(</span><span class="n">transcription</span><span class="p">))</span>

    <span class="c1"># Link phases</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">,</span> <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">,</span> <span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

    <span class="c1"># Set objective function</span>
    <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span>
        <span class="n">ballistic_ascent</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;final&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span>
        <span class="n">descent</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;final&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;objective=&#39;</span><span class="si">{</span><span class="n">objective</span><span class="si">}</span><span class="s2">&#39; is not defined. Try using &#39;height&#39; or &#39;range&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Add design parameters to the trajectory.</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;CD&#39;</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aero.CD&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aero.CD&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aero.CD&#39;</span><span class="p">]},</span>
                              <span class="n">val</span><span class="o">=</span><span class="mf">0.3450</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;CL&#39;</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aero.CL&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aero.CL&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aero.CL&#39;</span><span class="p">]},</span>
                              <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;eom.T&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;eom.T&#39;</span><span class="p">]},</span>
                              <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;eom.alpha&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;eom.alpha&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;eom.alpha&#39;</span><span class="p">]},</span>
                              <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;m_empty&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="s1">&#39;m_empty&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="s1">&#39;m_empty&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="s1">&#39;mass&#39;</span><span class="p">},</span>
                              <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                              <span class="n">opt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;V_b&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="s1">&#39;V_b&#39;</span><span class="p">},</span>
                              <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">106e-3</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;A_out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**2&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">22e-3</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;water_engine.A_out&#39;</span><span class="p">]},</span>
                              <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traj</span><span class="o">.</span><span class="n">add_design_parameter</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;water_engine.k&#39;</span><span class="p">]})</span>

    <span class="k">return</span> <span class="n">traj</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">propelled_ascent</span><span class="p">,</span>
                  <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">ballistic_ascent</span><span class="p">,</span>
                  <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">descent</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="optimizing-for-height">
<h2>Optimizing for height<a class="headerlink" href="#optimizing-for-height" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">om</span><span class="o">.</span><span class="n">Group</span><span class="p">())</span>

<span class="n">traj</span><span class="p">,</span> <span class="n">phases</span> <span class="o">=</span> <span class="n">new_water_rocket_trajectory</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;traj&#39;</span><span class="p">,</span> <span class="n">traj</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SLSQP&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5e-5</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">declare_coloring</span><span class="p">()</span>

<span class="c1"># Finish Problem Setup</span>
<span class="n">p</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">linear_solver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">DirectSolver</span><span class="p">()</span>
<span class="c1"># p.driver.add_recorder(om.SqliteRecorder(&#39;ex_water_rocket.db&#39;))</span>

<span class="n">p</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">set_sane_initial_guesses</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">phases</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">summarize_results</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">value</span><span class="si">:</span><span class="s1">6.4f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">exp_out</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">times_per_seg</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># NOTE: only the last figure is shown in the generated docs</span>
<span class="n">plot_propelled_ascent</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">)</span>
<span class="n">plot_trajectory</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">)</span>
<span class="n">plot_states</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Check results (tolerance is relative unless value is zero)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Launch angle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Flight angle at end of propulsion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Empty mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Water volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Maximum range&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Maximum height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Maximum velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>--- Linkage Report [traj] ---
     propelled_ascent      ballistic_ascent
        time++         =  time--       
        states:r++     =  states:r--   
        states:gam++   =  states:gam-- 
        states:v++     =  states:v--   
        states:h++     =  states:h--   
     ballistic_ascent      descent
        time++         =  time--       
        states:r++     =  states:r--   
        states:gam++   =  states:gam-- 
        states:v++     =  states:v--   
        states:h++     =  states:h--   
----------------------------
Full total jacobian was computed 3 times, taking 0.332309 seconds.
Total jacobian shape: (151, 153) 


Jacobian shape: (151, 153)  (53.17% nonzero)
FWD solves: 124   REV solves: 0
Total colors vs. total size: 124 vs 153  (19.0% improvement)

Sparsity computed using tolerance: 1e-25
Time to compute sparsity: 0.332309 sec.
Time to compute coloring: 0.029784 sec.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
Iteration limit exceeded    (Exit mode 9)
            Current function value: -54.6034979015683
            Iterations: 1001
            Function evaluations: 10399
            Gradient evaluations: 1001
Optimization FAILED.
Iteration limit exceeded
-----------------------------------
Launch angle: 88.8437 deg
Flight angle at end of propulsion: 89.0000 deg
Empty mass: 0.1429 kg
Water volume: 0.8703 L
Maximum range: 3.2027 m
Maximum height: 54.6035 m
Maximum velocity: 47.2597 m/s

Simulating trajectory traj
Done simulating trajectory traj
88.84372162326301
89.00000000000004
0.14287524457526
0.87034387981198
3.202694076828489
54.60349790156829
47.25972606678689
</pre></div></div><div class="figure align-default">
<img alt="../_images/doc_plot_17.png" src="../_images/doc_plot_17.png" />
</div>
</div>
<div class="section" id="optimizing-for-range">
<h2>Optimizing for range<a class="headerlink" href="#optimizing-for-range" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">om</span><span class="o">.</span><span class="n">Group</span><span class="p">())</span>

<span class="n">traj</span><span class="p">,</span> <span class="n">phases</span> <span class="o">=</span> <span class="n">new_water_rocket_trajectory</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;range&#39;</span><span class="p">)</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;traj&#39;</span><span class="p">,</span> <span class="n">traj</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SLSQP&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5e-5</span>
<span class="n">p</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">declare_coloring</span><span class="p">()</span>

<span class="c1"># Finish Problem Setup</span>
<span class="n">p</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">linear_solver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">DirectSolver</span><span class="p">()</span>
<span class="c1"># p.driver.add_recorder(om.SqliteRecorder(&#39;ex_water_rocket.db&#39;))</span>

<span class="n">p</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">set_sane_initial_guesses</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">phases</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">summarize_results</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">value</span><span class="si">:</span><span class="s1">6.4f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">exp_out</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">times_per_seg</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># NOTE: only the last figure is shown in the generated docs</span>
<span class="n">plot_propelled_ascent</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">)</span>
<span class="n">plot_trajectory</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">)</span>
<span class="n">plot_states</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Check results (tolerance is relative unless value is zero)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Launch angle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Flight angle at end of propulsion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Empty mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Water volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Maximum range&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Maximum height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Maximum velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>--- Linkage Report [traj] ---
     propelled_ascent      ballistic_ascent
        time++         =  time--       
        states:r++     =  states:r--   
        states:h++     =  states:h--   
        states:v++     =  states:v--   
        states:gam++   =  states:gam-- 
     ballistic_ascent      descent
        time++         =  time--       
        states:r++     =  states:r--   
        states:h++     =  states:h--   
        states:v++     =  states:v--   
        states:gam++   =  states:gam-- 
----------------------------
Full total jacobian was computed 3 times, taking 0.323344 seconds.
Total jacobian shape: (151, 153) 


Jacobian shape: (151, 153)  (53.17% nonzero)
FWD solves: 124   REV solves: 0
Total colors vs. total size: 124 vs 153  (19.0% improvement)

Sparsity computed using tolerance: 1e-25
Time to compute sparsity: 0.323344 sec.
Time to compute coloring: 0.030362 sec.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
/home/travis/build/OpenMDAO/dymos/dymos/phase/phase.py:255: DeprecationWarning:The default behavior of &#x27;targets=_unspecified&#x27; is changing. It is currently equivalent to targets=None&#x27;, but in the future it will try to automatically connect to ODE inputs. Set targets=None to retain the old behavior.
Optimization terminated successfully.    (Exit mode 0)
            Current function value: -86.41263987802363
            Iterations: 48
            Function evaluations: 56
            Gradient evaluations: 48
Optimization Complete
-----------------------------------
Launch angle: 38.3400 deg
Flight angle at end of propulsion: 45.0290 deg
Empty mass: 0.1861 kg
Water volume: 0.9045 L
Maximum range: 86.4126 m
Maximum height: 23.5108 m
Maximum velocity: 42.4133 m/s

Simulating trajectory traj
Done simulating trajectory traj
38.34000053192043
45.02902301400145
0.18613421542270195
0.9044995007829173
86.41263987802361
23.510819554150657
42.413270793683274
</pre></div></div><div class="figure align-default">
<img alt="../_images/doc_plot_18.png" src="../_images/doc_plot_18.png" />
</div>
</div>
<div class="section" id="accessing-the-results">
<h2>Accessing the results<a class="headerlink" href="#accessing-the-results" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">summarize_results</span><span class="p">(</span><span class="n">water_rocket_problem</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">water_rocket_problem</span>
    <span class="n">Entry</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">,</span> <span class="s1">&#39;value unit&#39;</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Launch angle&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:gam&#39;</span><span class="p">,</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;deg&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Flight angle at end of propulsion&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:gam&#39;</span><span class="p">,</span>
                                                   <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;deg&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Empty mass&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.design_parameters:m_empty&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;kg&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Water volume&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:V_w&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Maximum range&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.states:r&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Maximum height&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.states:h&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Maximum velocity&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:v&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m/s&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_propelled_ascent</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">t_imp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.time&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">t_exp</span> <span class="o">=</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.time&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_imp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:p&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_exp</span><span class="p">,</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:p&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;p (bar)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_imp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:V_w&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_exp</span><span class="p">,</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:V_w&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$V_w$ (L)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.design_parameters:V_b&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">))</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_imp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.T&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_exp</span><span class="p">,</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.T&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;T (N)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_imp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:v&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_exp</span><span class="p">,</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:v&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;v (m/s)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_imp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:gam&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_exp</span><span class="p">,</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:gam&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma$ (deg)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>

    <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_states</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;gam&#39;</span><span class="p">]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">]</span>
    <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">,</span> <span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">,</span> <span class="s1">&#39;descent&#39;</span><span class="p">]</span>

    <span class="n">time_imp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.time&#39;</span><span class="p">)}</span>

    <span class="n">time_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.time&#39;</span><span class="p">)}</span>

    <span class="n">x_imp</span> <span class="o">=</span> <span class="p">{</span><span class="n">phase</span><span class="p">:</span> <span class="p">{</span><span class="n">state</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;traj.</span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s2">.timeseries.states:</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
                     <span class="p">}</span>
             <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span>
             <span class="p">}</span>

    <span class="n">x_exp</span> <span class="o">=</span> <span class="p">{</span><span class="n">phase</span><span class="p">:</span> <span class="p">{</span><span class="n">state</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;traj.</span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s2">.timeseries.states:</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
                     <span class="p">}</span>
             <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span>
             <span class="p">}</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">units</span><span class="p">)):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;gam&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;$\gamma$ (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_imp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">],</span> <span class="n">x_imp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_imp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="n">x_imp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_imp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="n">x_imp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_exp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">],</span> <span class="n">x_exp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Propelled Ascent&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_exp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="n">x_exp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="s1">&#39;m-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ballistic Ascent&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_exp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="n">x_exp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Descent&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;gam&#39;</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">45</span><span class="p">))</span>

    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_trajectory</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exp_out</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="n">time_imp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.time&#39;</span><span class="p">)}</span>

    <span class="n">time_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.time&#39;</span><span class="p">)}</span>

    <span class="n">r_imp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.states:r&#39;</span><span class="p">),</span>
             <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:r&#39;</span><span class="p">),</span>
             <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.states:r&#39;</span><span class="p">)}</span>

    <span class="n">r_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.states:r&#39;</span><span class="p">),</span>
             <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:r&#39;</span><span class="p">),</span>
             <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.states:r&#39;</span><span class="p">)}</span>

    <span class="n">h_imp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.states:h&#39;</span><span class="p">),</span>
             <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:h&#39;</span><span class="p">),</span>
             <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.states:h&#39;</span><span class="p">)}</span>

    <span class="n">h_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.ballistic_ascent.timeseries.states:h&#39;</span><span class="p">),</span>
             <span class="s1">&#39;propelled_ascent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.propelled_ascent.timeseries.states:h&#39;</span><span class="p">),</span>
             <span class="s1">&#39;descent&#39;</span><span class="p">:</span> <span class="n">exp_out</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s1">&#39;traj.descent.timeseries.states:h&#39;</span><span class="p">)}</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_imp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">],</span> <span class="n">h_imp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_imp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="n">h_imp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_imp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="n">h_imp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_exp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">],</span> <span class="n">h_exp</span><span class="p">[</span><span class="s1">&#39;propelled_ascent&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_exp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="n">h_exp</span><span class="p">[</span><span class="s1">&#39;ballistic_ascent&#39;</span><span class="p">],</span> <span class="s1">&#39;m-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_exp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="n">h_exp</span><span class="p">[</span><span class="s1">&#39;descent&#39;</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r (m)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;h (m)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-examples/water_rocket-0"><dl class="citation">
<dt class="bibtex label" id="bbahia-2020"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Bernardo Bahia Monteiro. Optimization of a water rocket in openmdao/dymos. Aug 2020. URL: <a class="reference external" href="engrxiv.org/nqta8">engrxiv.org/nqta8</a>, <a class="reference external" href="https://doi.org/10.31224/osf.io/nqta8">doi:10.31224/osf.io/nqta8</a>.</p>
</dd>
<dt class="bibtex label" id="prusa2000"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Joseph M. Prusa. Hydrodynamics of a water rocket. <em>SIAM Review</em>, 42(4):719–726, jan 2000. <a class="reference external" href="https://doi.org/10.1137/s0036144598348223">doi:10.1137/s0036144598348223</a>.</p>
</dd>
<dt class="bibtex label" id="wheeler2002"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Dean Wheeler. Modeling the thrust phase. 2002. URL: <a class="reference external" href="https://www.et.byu.edu/~wheeler/benchtop/pix/thrust_eqns.pdf">https://www.et.byu.edu/~wheeler/benchtop/pix/thrust_eqns.pdf</a>.</p>
</dd>
<dt class="bibtex label" id="gommes2010"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Cedric J. Gommes. A more thorough analysis of water rockets: moist adiabats, transient flows, and inertial forces in a soda bottle. <em>American Journal of Physics</em>, 78(3):236–243, mar 2010. <a class="reference external" href="https://doi.org/10.1119/1.3257702">doi:10.1119/1.3257702</a>.</p>
</dd>
<dt class="bibtex label" id="barrioperotti2010"><span class="brackets"><a class="fn-backref" href="#id6">5</a></span></dt>
<dd><p>R Barrio-Perotti, E Blanco-Marigorta, J Fernández-Francos, and M Galdo-Vega. Theoretical and experimental analysis of the physics of water rockets. <em>European Journal of Physics</em>, 31(5):1131–1147, jul 2010. <a class="reference external" href="https://doi.org/10.1088/0143-0807/31/5/015">doi:10.1088/0143-0807/31/5/015</a>.</p>
</dd>
<dt class="bibtex label" id="thorncroft2009"><span class="brackets">6</span><span class="fn-backref">(<a href="#id7">1</a>,<a href="#id10">2</a>)</span></dt>
<dd><p>Glen E. Thorncroft, John R. Ridgely, and Christopher C. Pascual. Hydrodynamics and thrust characteristics of a water-propelled rocket. <em>International Journal of Mechanical Engineering Education</em>, 37(3):241–261, jul 2009. <a class="reference external" href="https://doi.org/10.7227/ijmee.37.3.9">doi:10.7227/ijmee.37.3.9</a>.</p>
</dd>
<dt class="bibtex label" id="barrioperotti2009"><span class="brackets">7</span><span class="fn-backref">(<a href="#id8">1</a>,<a href="#id9">2</a>)</span></dt>
<dd><p>R Barrio-Perotti, E Blanco-Marigorta, K Argüelles-D’ıaz, and J Fernández-Oro. Experimental evaluation of the drag coefficient of water rockets by a simple free-fall test. <em>European Journal of Physics</em>, 30(5):1039–1048, jul 2009. <a class="reference external" href="https://doi.org/10.1088/0143-0807/30/5/012">doi:10.1088/0143-0807/30/5/012</a>.</p>
</dd>
<dt class="bibtex label" id="fischer2020"><span class="brackets"><a class="fn-backref" href="#id11">8</a></span></dt>
<dd><p>Laura Fischer, Thomas Günther, Linda Herzig, Tobias Jarzina, Frank Klinker, Sabine Knipper, Franz-Georg Schürmann, and Marvin Wollek. On the approximation of D.I.Y. water rocket dynamics including air drag. arXiv:2001.08828, 2020. <a class="reference external" href="https://arxiv.org/abs/2001.08828">arXiv:2001.08828</a>.</p>
</dd>
<dt class="bibtex label" id="romanelli2013"><span class="brackets"><a class="fn-backref" href="#id12">9</a></span></dt>
<dd><p>Alejandro Romanelli, Italo Bove, and Federico González Madina. Air expansion in a water rocket. <em>American Journal of Physics</em>, 81(10):762–766, oct 2013. <a class="reference external" href="https://doi.org/10.1119/1.4811116">doi:10.1119/1.4811116</a>.</p>
</dd>
<dt class="bibtex label" id="aircommand-nozzle"><span class="brackets"><a class="fn-backref" href="#id13">10</a></span></dt>
<dd><p>Nozzles. <span><a class="reference external" href="#"></a></span>http://www.aircommandrockets.com/nozzles.htm, 2013.</p>
</dd>
</dl>
</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Water Rocket</a><ul>
<li><a class="reference internal" href="#nomenclature">Nomenclature</a></li>
<li><a class="reference internal" href="#problem-formulation">Problem Formulation</a></li>
<li><a class="reference internal" href="#model">Model</a></li>
<li><a class="reference internal" href="#water-engine">Water engine</a></li>
<li><a class="reference internal" href="#phases">Phases</a></li>
<li><a class="reference internal" href="#model-parameters">Model parameters</a></li>
<li><a class="reference internal" href="#puttting-it-all-together">Puttting it all together</a></li>
<li><a class="reference internal" href="#optimizing-for-height">Optimizing for height</a></li>
<li><a class="reference internal" href="#optimizing-for-range">Optimizing for range</a></li>
<li><a class="reference internal" href="#accessing-the-results">Accessing the results</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="multi_phase_cannonball.html"
                        title="previous chapter">Multi-Phase Cannonball</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="multibranch_trajectory.html"
                        title="next chapter">Multibranch Trajectory</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/water_rocket.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="multibranch_trajectory.html" title="Multibranch Trajectory"
             >next</a> |</li>
        <li class="right" >
          <a href="multi_phase_cannonball.html" title="Multi-Phase Cannonball"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">dymos 0.15.1-dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" >Dymos by Example</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Water Rocket</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, National Aeronautics and Space Administration.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.0.
    </div>
  </body>
</html>